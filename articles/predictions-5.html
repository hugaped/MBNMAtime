<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Calculating model predictions • MBNMAtime</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculating model predictions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MBNMAtime</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/consistencychecking-3.html">Checking for consistency</a></li>
    <li><a class="dropdown-item" href="../articles/dataexploration-1.html">Exploring the data</a></li>
    <li><a class="dropdown-item" href="../articles/mbnmatime-overview.html">MBNMAtime: Package Overview</a></li>
    <li><a class="dropdown-item" href="../articles/outputs-4.html">Outputs: Relative effects, forest plots and rankings</a></li>
    <li><a class="dropdown-item" href="../articles/predictions-5.html">Calculating model predictions</a></li>
    <li><a class="dropdown-item" href="../articles/runmbnmatime-2.html">Perform a time-course Model-Based Network Meta-Analysis (MBNMA)</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculating model predictions</h1>
                        <h4 data-toc-skip class="author">Hugo
Pedder</h4>
            
            <h4 data-toc-skip class="date">2025-02-03</h4>
      

      <div class="d-none name"><code>predictions-5.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="prediction">Prediction<a class="anchor" aria-label="anchor" href="#prediction"></a>
</h2>
<p>After performing an MBNMA, predictions can be calculated from the
parameter estimates using <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> on an
<code>"mbnma"</code> object. A number of important parameters need to be
identified to make robust predictions. However, default values can be
used that set values of zero for the reference treatment baseline and
time-course parameters which indicates that mean differences / relative
treatment effects should be estimated. For further information the help
file can be accessed using <code><a href="../reference/predict.mbnma.html">?predict.mbnma</a></code>.</p>
<div class="section level3">
<h3 id="e0-time0">E0 (time=0)<a class="anchor" aria-label="anchor" href="#e0-time0"></a>
</h3>
<p>One key parameter is <code>E0</code>, which defines what value(s) to
use for the predicted mean at time = 0. A single numeric value can be
given for <code>E0</code> to indicate a deterministic value, or a
function representing a random number generator (RNG) distribution in R
(stochastic) (e.g. <code>E0 = ~rnorm(n, 7, 0.2)</code>. These values can
be identified for the population of interest from external data
(e.g. observational/registry).</p>
</div>
<div class="section level3">
<h3 id="baseline-reference-treatment-time-course">Baseline (reference treatment) time-course<a class="anchor" aria-label="anchor" href="#baseline-reference-treatment-time-course"></a>
</h3>
<p>The more challenging parameter(s) to identify are those for the
network reference treatment time-course, supplied to
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> in the <code>ref.resp</code> argument. For
estimating mean differences / relative treatment effects over time this
does not need to be specified since typically in an MBNMA, relative
effects are estimated and the network reference effect is modeled as a
nuisance parameter.</p>
<p>However, for predicting mean responses over time we need to provide
an input for the network reference treatment effect for all time-course
parameters modeled using <code>pool="rel"</code> so that we can apply
the relative effects estimated in our model to it. There are two options
for providing these values.</p>
<p>The first approach is to give values for each time-course parameter
modeled using relative effects to <code>ref.resp</code>. This is given
as a list, with a separate named element for each time-course parameter.
Each element can take either a single numeric value (deterministic), or
a function representing a random number generator distribution in R
(stochastic).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run an Emax time-course MBNMA using the osteoarthritis dataset</span></span>
<span><span class="va">mbnma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mb.run.html">mb.run</a></span><span class="op">(</span><span class="va">network.pain</span>,</span>
<span>                fun<span class="op">=</span><span class="fu"><a href="../reference/temax.html">temax</a></span><span class="op">(</span>pool.emax<span class="op">=</span><span class="st">"rel"</span>, method.emax<span class="op">=</span><span class="st">"common"</span>,</span>
<span>                          pool.et50<span class="op">=</span><span class="st">"abs"</span>, method.et50<span class="op">=</span><span class="st">"common"</span><span class="op">)</span>,</span>
<span>                rho<span class="op">=</span><span class="st">"dunif(0,1)"</span>, covar<span class="op">=</span><span class="st">"varadj"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specify placebo time-course parameters</span></span>
<span><span class="va">ref.params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>emax<span class="op">=</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predict responses for a selection of treatments using a stochastic E0 and</span></span>
<span><span class="co"># placebo parameters defined in ref.params to estimate the network reference treatment effect</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mbnma</span>, treats<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pl_0"</span>, <span class="st">"Ce_200"</span>, <span class="st">"Du_90"</span>, <span class="st">"Et_60"</span>, </span>
<span>                                        <span class="st">"Lu_400"</span>, <span class="st">"Na_1000"</span>, <span class="st">"Ox_44"</span>, <span class="st">"Ro_25"</span>,</span>
<span>                                        <span class="st">"Tr_300"</span>, <span class="st">"Va_20"</span><span class="op">)</span>,</span>
<span>                        E0<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">8</span>, <span class="fl">0.5</span><span class="op">)</span>, ref.resp<span class="op">=</span><span class="va">ref.params</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span></code></pre></div>
<p>The second is to assign <code>ref.resp</code> a data frame composed
of single-arm studies of the network reference treatment. A separate
synthesis model for the reference treatment effect will then be run, and
the values from this used as the prediction reference treatment effect.
This dataset could be a series of observational studies measured at
multiple follow-up times that closely match the population of interest
for the prediction. Alternatively it could be a subset of data from the
original RCT dataset used for the MBNMA model (though this may be less
generalisable to the population of interest).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate a dataset of network reference treatment responses over time</span></span>
<span><span class="va">placebo.df</span> <span class="op">&lt;-</span> <span class="va">network.pain</span><span class="op">$</span><span class="va">data.ab</span><span class="op">[</span><span class="va">network.pain</span><span class="op">$</span><span class="va">data.ab</span><span class="op">$</span><span class="va">treatment</span><span class="op">==</span><span class="fl">1</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Predict responses for a selection of treatments using a deterministic E0 and </span></span>
<span><span class="co">#placebo.df to model the network reference treatment effect</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mbnma</span>, treats<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pl_0"</span>, <span class="st">"Ce_200"</span>, <span class="st">"Du_90"</span>, <span class="st">"Et_60"</span>, </span>
<span>                                        <span class="st">"Lu_400"</span>, <span class="st">"Na_1000"</span>, <span class="st">"Ox_44"</span>, <span class="st">"Ro_25"</span>,</span>
<span>                                        <span class="st">"Tr_300"</span>, <span class="st">"Va_20"</span><span class="op">)</span>,</span>
<span>                        E0<span class="op">=</span><span class="fl">10</span>, ref.resp<span class="op">=</span><span class="va">placebo.df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span></code></pre></div>
<p>It is also possible specify the time points for which to make
predictions (<code>times</code>), given as a vector of positive numbers.
If left as the default then the maximum follow-up in the dataset will be
used as the upper limit for the range of predicted time-points.</p>
</div>
<div class="section level3">
<h3 id="exploring-predictions">Exploring predictions<a class="anchor" aria-label="anchor" href="#exploring-predictions"></a>
</h3>
<p>An object of class <code>"mb.predict"</code> is returned, which is a
list of summary tables and MCMC prediction matrices for each treatment,
in addition to the original <code>mbnma</code> object. The
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> method can be used to print mean posterior
predictions at each time point for each treatment.</p>
<p>Predicted values can also be plotted using the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>
method on an object of <code>class("mb.predict")</code>. Within the
default arguments, the median predicted network reference treatment
effect is overlaid on the predictions for each treatment. Setting
<code>overlay.ref = FALSE</code> prevents this and causes the network
reference treatment effect to be plotted as a separate panel. Shaded
counts of observations in the original dataset at each predicted time
point can be plotted over the 95% CrI for each treatment by setting
<code>disp.obs = TRUE</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred</span>, overlay.ref<span class="op">=</span><span class="cn">TRUE</span>, disp.obs<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictions-5_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p>This can be used to identify any extrapolation/interpretation of the
time-course that might be occurring for a particular treatment, and
where predictions might therefore be problematic.</p>
<p>To illustrate a situation in which this could be very informative, we
can look at predictions for a quadratic time-course function fitted to
the Obesity dataset:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit a quadratic time-course MBNMA to the Obesity dataset</span></span>
<span><span class="va">network.obese</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mb.network.html">mb.network</a></span><span class="op">(</span><span class="va">obesityBW_CFB</span>, reference <span class="op">=</span> <span class="st">"plac"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mbnma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mb.run.html">mb.run</a></span><span class="op">(</span><span class="va">network.obese</span>,</span>
<span>                fun<span class="op">=</span><span class="fu"><a href="../reference/tpoly.html">tpoly</a></span><span class="op">(</span>degree<span class="op">=</span><span class="fl">2</span>,</span>
<span>                          pool.1 <span class="op">=</span> <span class="st">"rel"</span>, method.1<span class="op">=</span><span class="st">"common"</span>,</span>
<span>                          pool.2<span class="op">=</span><span class="st">"rel"</span>, method.2<span class="op">=</span><span class="st">"common"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define stochastic values centred at zero for network reference treatment</span></span>
<span><span class="va">ref.params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta.1<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">0.05</span><span class="op">)</span>, beta.2<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">0.0001</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predict responses within the range of the data</span></span>
<span><span class="va">pred.obese</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mbnma</span>, times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span>, E0<span class="op">=</span><span class="fl">100</span>, treats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span>,<span class="fl">15</span><span class="op">)</span>,</span>
<span>                        ref.resp<span class="op">=</span><span class="va">ref.params</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot predictions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred.obese</span>, disp.obs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictions-5_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>As you can see, within the limits of the observed data the predicted
values appear reasonable. However, extrapolation beyond this for
<code>dexf_30MG</code> leads to some rather strange results, suggesting
an unrealistically huge increase in body weight after 50 weeks of
treatment. On the other hand, the predicted response at 50 weeks
follow-up in treatment 15 is within the limits of the observed data and
so are likely to be more justifiable.</p>
<div class="section level4">
<h4 id="plotting-lumped-nma-results">Plotting “lumped” NMA results<a class="anchor" aria-label="anchor" href="#plotting-lumped-nma-results"></a>
</h4>
<p>As a further addition to the plots of MBNMA predictions, it is
possible to add predicted results from an NMA model or multiple “lumped”
NMA models performed a different time “bins” (specified in
<code>overlay.nma</code>), time periods within which we are assuming
treatment effects are constant over time. This is similar to the output
generated by <code><a href="../reference/binplot.html">binplot()</a></code>. Either a <code>"random"</code> (the
default) or <code>"common"</code> effects NMA can be specified, and
model fit statistics are reported below the resulting plot.</p>
<p>This can be useful to assess if the MBNMA predictions are in
agreement with predictions from lumped NMA models over a specific set of
time-points, and can be a general indicator of the fit of the
time-course model. However, it is important to note that the NMA model
is not necessarily the more robust model, since it ignores potential
differences in treatment effects that may arise from lumping time-points
together. The wider the range specified in <code>overlay.nma</code>, the
greater the effect of lumping and the stronger the assumption of
similarity between studies.</p>
<p>The NMA predictions are plotted over the range specified in
<code>overlay.nma</code> as a horizontal line representing the posterior
median, with the 95%CrI shown by a shaded rectangle. The NMA predictions
in theory represent those for <em>any time-points within this range</em>
since they lump together data at all these time-points, though the width
(x-axis) of the shaded rectangle represents the range of time-points for
studies included in each time bin. Predictions for treatments that are
disconnected from the network reference treatment at data points
specified within <code>overlay.nma</code> cannot be estimated so are not
included.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Overlay predictions from lumped NMAs between 5-8 and between 8-15 weeks follow-up</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred</span>, overlay.nma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">8</span>,<span class="fl">15</span><span class="op">)</span>, n.iter<span class="op">=</span><span class="fl">20000</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reference treatment in plots is Pl_0</span></span>
<span><span class="co">#&gt; Running overlay.nma for time=5 and time=8</span></span>
<span><span class="co">#&gt; Running overlay.nma for time=8 and time=15</span></span></code></pre></div>
<p><img src="predictions-5_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="ranking">Ranking<a class="anchor" aria-label="anchor" href="#ranking"></a>
</h4>
<p>Predictions can also be ranked, allowing for ranking of predicted
efficacy at a single time-point. We will illustrate this by ranking mean
differences from the network reference treatment (i.e. by setting
<code>ref.resp=NULL</code> and <code>E0=0</code>).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Predict responses within the range of data</span></span>
<span><span class="va">pred.obese</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mbnma</span>, times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span>,</span>
<span>                      E0<span class="op">=</span><span class="fl">0</span>, ref.resp <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; Priors required for: mu.1, mu.2</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00; font-weight: bold;">Success: Elements in prior match consistency time-course treatment effect parameters</span></span></span>
<span></span>
<span><span class="co"># Rank predictions at 50 weeks follow-up</span></span>
<span><span class="va">ranks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rank.html">rank</a></span><span class="op">(</span><span class="va">pred.obese</span>, time<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ranks</span><span class="op">)</span></span>
<span><span class="co">#&gt;              Length Class      Mode     </span></span>
<span><span class="co">#&gt; param             1 -none-     character</span></span>
<span><span class="co">#&gt; summary           8 data.frame list     </span></span>
<span><span class="co">#&gt; prob.matrix     676 -none-     numeric  </span></span>
<span><span class="co">#&gt; rank.matrix  117000 -none-     numeric  </span></span>
<span><span class="co">#&gt; cum.matrix      676 -none-     numeric  </span></span>
<span><span class="co">#&gt; lower_better      1 -none-     logical</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ranks</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictions-5_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>The results indicate that dexf_60MG (Dexfenfluramine 60mg) is the
highest ranked treatment.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hugo Pedder.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
